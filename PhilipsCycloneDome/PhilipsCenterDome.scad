$fn=50;

fudge=0.1;
outDia=42.6;
inDia=36.6;
maxWallThck=(outDia-inDia)/2;

turbHght=46;
flngDias=[39.2,40,outDia];
flngHghts=[12.65,12.1];
flngHght=flngHghts[0]+flngHghts[1];

flange();
translate([0,0,flngHght-maxWallThck/2]) turbine(turbHght+maxWallThck/2,debug=false);
translate([0,0,flngHght+turbHght]) top();


module top(){
  rotate_extrude(){
    translate([0,-maxWallThck/2]) square([(outDia-maxWallThck)/2,maxWallThck]);
    translate([(outDia-maxWallThck)/2,0]) circle(d=maxWallThck);
  }
}

module turbine(hght=46,debug=true){
  noBlades=17;
  radius=20.2;
  tilt=54;
  innerDbgDia=27;
  outerDbgDia=42;
  if (debug)
    difference(){
      circle(d=outerDbgDia);
      circle(d=innerDbgDia);
    }
  //extrude, rotate, tilt and translate blades
  intersection(){
    for (ir=[0:(360/noBlades):360])
      rotate(ir) translate([radius,0,0]) rotate(-90-tilt){
         linear_extrude(hght) airFoil();
        mirror([0,0,1]) airFoilCaps();
      }
    translate([0,0,-flngHght+maxWallThck/2]) flange(true);
  }
    
}


module flange(fill=false){
  maxWallThck= fill ? 0 : maxWallThck;
  flngHghts= fill ? flngHghts + [0,turbHght]:flngHghts;
  difference(){
    union(){
      cylinder(d1=39.2,d2=40,h=flngHghts[0]);
      translate([0,0,12.65]) cylinder(d=outDia,h=flngHghts[1]-maxWallThck/2);
      if (!fill) translate([0,0,12.65+12.1-maxWallThck/2]) rotate_extrude() translate([outDia/2-maxWallThck/2,0]) circle(d=maxWallThck);
    }
    if (!fill) translate([0,0,-fudge/2]) cylinder(d=inDia,h=12.65+12.1+fudge);
    //hooks
    for (ir=[0:360/3:360*(1-1/3)],iz=[0:2])
      rotate(ir) rotate_extrude(angle=20) translate([inDia/2+0.6+1,1-fudge/2+iz*4.7]) square(2,true);
  }
}

*airFoilCaps();
module airFoilCaps(LeadIn=true){
  linear_extrude(16,scale=0.1) airFoil(true);
}


module airFoil(topOnly=true){
  //generated with https://aerotoolbox.com/naca-4-series-airfoil-generator/
NACA9335top=[[0,0],[-0.395837,0.71737],[-0.733963,1.45603],[-1.01277,2.216324],[-1.23069,2.998309],[-1.386197,3.80176],[-1.477798,4.626166],[-1.504044,5.470733],[-1.463523,6.334386],[-1.354871,7.215771],[-1.176774,8.113258],[-0.927977,9.024949],[-0.607296,9.948679],[-0.213621,10.882025],[0.254064,11.822309],[0.79667,12.766611],[1.414987,13.711773],[2.109667,14.654408],[2.881205,15.590916],[3.729919,16.517489],[4.655926,17.43013],[5.659124,18.324667],[6.739163,19.196769],[7.895424,20.041972],[9.126993,20.855693],[10.432638,21.63327],[11.810782,22.36998],[13.25949,23.061083],[14.776441,23.701857],[16.358923,24.287643],[18.003816,24.81389],[19.707597,25.27621],[21.466341,25.670424],[23.275738,25.992624],[25.131112,26.239227],[27.027461,26.407024],[28.959499,26.493235],[30.726639,26.500929],[32.294065,26.465767],[33.879946,26.394948],[35.482236,26.288918],[37.098881,26.14822],[38.727825,25.973493],[40.367012,25.765465],[42.014394,25.524949],[43.667935,25.252836],[45.325613,24.950091],[46.985426,24.617747],[48.645396,24.256897],[50.303572,23.868694],[51.95803,23.454338],[53.606883,23.015077],[55.248273,22.552198],[56.880386,22.067026],[58.50144,21.560915],[60.1097,21.035247],[61.703468,20.491427],[63.281094,19.93088],[64.840968,19.355047],[66.381529,18.765384],[67.90126,18.16336],[69.398694,17.550449],[70.872407,16.928138],[72.321026,16.297916],[73.743227,15.661279],[75.137734,15.019725],[76.503318,14.374756],[77.838802,13.727872],[79.143057,13.080576],[80.415006,12.434369],[81.653618,11.790749],[82.857914,11.151211],[84.026964,10.517245],[85.159886,9.890333],[86.255848,9.27195],[87.314066,8.663559],[88.333803,8.066611],[89.314369,7.482538],[90.255122,6.912758],[91.155463,6.358662],[92.014837,5.821619],[92.832733,5.302968],[93.608681,4.804015],[94.342249,4.326029],[95.033045,3.870237],[95.680714,3.437822],[96.284933,3.029916],[96.845415,2.647597],[97.3619,2.291884],[97.834162,1.963735],[98.261998,1.664038],[98.645234,1.393611],[98.983716,1.153199],[99.277315,0.943465],[99.525921,0.764993],[99.729444,0.618282],[99.887813,0.503743],[100.000972,0.421697],[100.068883,0.372377],[100.091523,0.355921]];
NACA9335bot=[[99.908477,-0.355921],[99.880771,-0.359433],[99.797695,-0.369963],[99.659379,-0.387495],[99.466037,-0.412],[99.217968,-0.443442],[98.915555,-0.481774],[98.559263,-0.526937],[98.149636,-0.578869],[97.687299,-0.637497],[97.17295,-0.702743],[96.607362,-0.774524],[95.991379,-0.852752],[95.325913,-0.937337],[94.61194,-1.028187],[93.850499,-1.125208],[93.042689,-1.228305],[92.18966,-1.337383],[91.29262,-1.452349],[90.352821,-1.573108],[89.371563,-1.699568],[88.350187,-1.831633],[87.290075,-1.969208],[86.192642,-2.112198],[85.059338,-2.260502],[83.891641,-2.414014],[82.691055,-2.572622],[81.459109,-2.736204],[80.197352,-2.904628],[78.90735,-3.077746],[77.590685,-3.255393],[76.248949,-3.437384],[74.883745,-3.623508],[73.496682,-3.813531],[72.089374,-4.007186],[70.663434,-4.204173],[69.220475,-4.404156],[67.762106,-4.606758],[66.289929,-4.811562],[64.805536,-5.018105],[63.310509,-5.225876],[61.806413,-5.434318],[60.2948,-5.642823],[58.777198,-5.850733],[57.255118,-6.057339],[55.730043,-6.261883],[54.203434,-6.463558],[52.676722,-6.661509],[51.151309,-6.854838],[49.628566,-7.042604],[48.109832,-7.223827],[46.596412,-7.397496],[45.089578,-7.562569],[43.590567,-7.71798],[42.100581,-7.862647],[40.620788,-7.995476],[39.152322,-8.115367],[37.696282,-8.221224],[36.253738,-8.311958],[34.825727,-8.386498],[33.413257,-8.443797],[32.017312,-8.482837],[30.638849,-8.502642],[29.498999,-8.505116],[28.565877,-8.504118],[27.641781,-8.500383],[26.724262,-8.492624],[25.811112,-8.47974],[24.900397,-8.460779],[23.990493,-8.434915],[23.080109,-8.40141],[22.168292,-8.359584],[21.254437,-8.308782],[20.338276,-8.248354],[19.419874,-8.177625],[18.499603,-8.09588],[17.578131,-8.002349],[16.656393,-7.896196],[15.735567,-7.776516],[14.817048,-7.642329],[13.902423,-7.492581],[12.993441,-7.32615],[12.091991,-7.141848],[11.200075,-6.938434],[10.319785,-6.714616],[9.453282,-6.469065],[8.602775,-6.200422],[7.770502,-5.907313],[6.958715,-5.588356],[6.169662,-5.24217],[5.405573,-4.86739],[4.668653,-4.462673],[3.961065,-4.026705],[3.284929,-3.558217],[2.642308,-3.055982],[2.035209,-2.518834],[1.465577,-1.945664],[0.935295,-1.335433],[0.446183,-0.687175]];
poly= topOnly ? NACA9335top : concat(NACA9335top,NACA9335bot);
  $fn=100;
  leading=3;
  trailing=0.1;
  chord=10;
  scale(0.1) polygon(poly);
}